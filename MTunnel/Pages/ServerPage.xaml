<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MTunnel.Pages.ServerPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MTunnel.Pages"
    xmlns:localComponents="using:MTunnel.Components"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="8"/>

        <Grid Grid.Row="1" Margin="24,0,24,24" VerticalAlignment="Top">
            <StackPanel x:Name="TokenViewPanel" Visibility="Visible" Spacing="12">
                <StackPanel Spacing="4">
                    <TextBlock Text="Token" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                    <TextBlock
                        Text="Please share this token with clients to connect" 
                        Style="{ThemeResource BodyTextBlockStyle}" 
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>

                <Grid
                    Background="{ThemeResource SolidBackgroundFillColorQuarternaryBrush}" 
                    CornerRadius="8" 
                    Padding="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock
                        Text="{Binding Token}"
                        x:Name="TokenTextBlock"
                        FontFamily="Consolas"
                        TextWrapping="Wrap"
                        VerticalAlignment="Top"
                        IsTextSelectionEnabled="True"
                        Margin="0,0,12,0"/>

                    <localComponents:CopyButton
                        Token="{Binding Token}"
                        Grid.Column="1"/>
                </Grid>

                <StackPanel x:Name="GeneratingTokenPanel" Visibility="Collapsed" Orientation="Horizontal" Spacing="12">
                    <ProgressRing IsActive="True" Width="20" Height="20"/>
                    <TextBlock Text="Generating token, please wait..." VerticalAlignment="Center"/>
                </StackPanel>
            </StackPanel>

            <ListView
                x:Name="ConnectedViewPanel"
                Visibility="Collapsed"
                ItemsSource="{x:Bind Clients}"
                HorizontalAlignment="Stretch"
                Width="Auto">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="local:ConnectedClient">
                        <StackPanel Spacing="8">
                            <TextBlock
                                Text="{x:Bind ID}" 
                                FontFamily="Consolas"
                                FontSize="16"
                                TextWrapping="Wrap"
                                IsTextSelectionEnabled="True"/>

                            <TextBlock
                                Text="From:"
                                Style="{ThemeResource CaptionTextBlockStyle}"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                            <TextBlock
                                Text="{x:Bind ConnectionPath}" 
                                FontFamily="Consolas" 
                                FontSize="12"/>

                            <Button
                                x:Name="DisconnectButton" 
                                Content="Disconnect"
                                HorizontalAlignment="Stretch"
                                Margin="0,12,0,0">
                            </Button>
                        </StackPanel>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>

        <Grid
            Grid.Row="2"
            Padding="16"
            ColumnSpacing="8"
            Background="{ThemeResource LayerFillColorDefaultBrush}"
            BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
            BorderThickness="0,1,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button 
                HorizontalAlignment="Stretch"
                Click="TerminateClick">
                <StackPanel
                    Orientation="Horizontal"
                    Spacing="8"
                    HorizontalAlignment="Center">
                    <FontIcon Glyph="&#xE711;" FontSize="16"/>
                    <TextBlock Text="Terminate"/>
                </StackPanel>
            </Button>

            <localComponents:CopyButton
                Token="{Binding Token}"
                BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                BorderThickness="1"
                x:Name="CloseButton"
                Grid.Column="1"/>
        </Grid>
    </Grid>
</Page>
