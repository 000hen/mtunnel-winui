<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MTunnel.Pages.ClientPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MTunnel.Pages"
    xmlns:localComponents="using:MTunnel.Components"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="8"/>

        <Grid Grid.Row="1" VerticalAlignment="Top">
            <StackPanel
                x:Name="TokenViewPanel"
                Spacing="12"
                Padding="16,0">
                <StackPanel Spacing="4" Visibility="{x:Bind ViewModel.IsNotConnected, Mode=OneWay}">
                    <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}">Establish connection</TextBlock>
                    <TextBlock
                        Style="{ThemeResource BodyTextBlockStyle}" 
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                        Please wait
                    </TextBlock>
                </StackPanel>

                <StackPanel Spacing="4" Visibility="{x:Bind ViewModel.IsConnected, Mode=OneWay}">
                    <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}">Connected!</TextBlock>
                    <TextBlock
                        Style="{ThemeResource BodyTextBlockStyle}" 
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                        You have successfully created the tunnel to the peer!
                    </TextBlock>

                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock
                            Style="{ThemeResource CaptionTextBlockStyle}"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                            Session ID:
                        </TextBlock>

                        <TextBlock
                            Text="{x:Bind ViewModel.SessionID, Mode=OneWay}" 
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            FontFamily="Consolas" 
                            FontSize="12"
                            IsTextSelectionEnabled="True"
                            TextWrapping="Wrap"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Visibility="{x:Bind ViewModel.IsConnected, Mode=OneWay}">
                    <Grid
                        Background="{ThemeResource SolidBackgroundFillColorQuarternaryBrush}" 
                        CornerRadius="8"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        Padding="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock
                            Text="{x:Bind ViewModel.ConnectionAddress, Mode=OneWay}"
                            x:Name="TokenTextBlock"
                            FontFamily="Consolas"
                            TextWrapping="Wrap"
                            VerticalAlignment="Top"
                            IsTextSelectionEnabled="True"
                            FontSize="32"
                            Margin="0,0,12,0"/>

                        <localComponents:CopyButton
                            Token="{x:Bind ViewModel.ConnectionAddress, Mode=OneWay}"
                            Grid.Column="1"/>
                    </Grid>

                    <TextBlock
                        FontStyle="Italic"
                        Style="{ThemeResource BodyTextBlockStyle}" 
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Margin="0,8">
                        Notice: This address is only accessable from your local machine.
                    </TextBlock>
                </StackPanel>

                <StackPanel
                    x:Name="GeneratingTokenPanel"
                    Visibility="{x:Bind ViewModel.IsNotConnected, Mode=OneWay}"
                    Orientation="Horizontal"
                    Spacing="12">
                    <ProgressRing IsActive="True" Width="20" Height="20"/>
                    <TextBlock VerticalAlignment="Center">Connecting to peer, please wait...</TextBlock>
                </StackPanel>
            </StackPanel>
        </Grid>

        <localComponents:ControlOptionsControl
            x:Name="ControlOptionsControl"
            Grid.Row="2"
            TerminateClick="Terminate"
            ForceTerminateClick="ForceTerminate"
            Token="{x:Bind ViewModel.ConnectionAddress, Mode=OneWay}"/>
    </Grid>
</Page>
